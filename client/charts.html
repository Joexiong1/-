<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    
    <META HTTP-EQUIV="pragma" CONTENT="no-cache"> 
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate"> 
    <META HTTP-EQUIV="expires" CONTENT="0">
    <!--引入css-->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./layui/css/layui.css">
    <!-- <link href="./css/selectCSS/jquery.searchableSelect.css" rel="stylesheet" type="text/css"> -->
    
    <script
        src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode:'12aa9a979246fbdb20ed7b3a826a88e5',
        }
    </script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=8617b9dc986fb5f7216967a07af11952"></script> 
    <script src="https://webapi.amap.com/loader.js"></script>
    
    

    <title>校园排课交互系统</title>
</head>
<body>
    <body class="layui-layout-body">
        <!-- 顶部区域 -->
        <div class="layui-layout layui-layout-admin">
            <div class="layui-header">
                <div class="layui-logo layui-hide-xs layui-bg-black "> <a href="open.html" style="color: white;">校园排课交互系统</a>  </div>
                <!-- 头部区域（可配合layui 已有的水平导航） -->
                <ul class="layui-nav layui-layout-right">
                    <li class="layui-nav-item layui-hide-xs"><a href="index.html">课表状态</a></li>
                    <li class="layui-nav-item layui-hide-xs"><a href="charts.html">数据展示</a></li>
                    <li class="layui-nav-item layui-hide-xs"><a href=""></a></li>
                    <li class="layui-nav-item">
                    <a href="javascript:;">深圳大学</a>
                    <dl class="layui-nav-child">
                        <dd><a href="https://www.szu.edu.cn/" target="_blank">深大主页</a></dd>
                        <dd><a href="https://www1.szu.edu.cn/" target="_blank">深大内部网</dd>
                        <dd><a href="http://ehall.szu.edu.cn/" target="_blank">办事大厅</a></dd>
                    </dl>
                    </li>
                </ul>
                <ul class="layui-nav layui-layout-left">
                    <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                    <a href="javascript:;">
                        <img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg" class="layui-nav-img">
                        tester
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="">Your Profile</a></dd>
                        <dd><a href="">Settings</a></dd>
                        <dd><a href="">Sign out</a></dd>
                    </dl>
                    </li>
                   
                </ul>
            </div>
            <!-- 左侧导航栏 -->
            <div class="layui-tab layui-side layui-tab-card site-demo-button">
                <ul class="layui-nav layui-side layui-nav-tree layui-nav-side">
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="javascript:;">班级情况</a>
                        <dl class="layui-nav-child">
                            <dd>
                                <!--TODO -->
                                <!--需要修改为⾃⼰项⽬的部分：-->
                                <!--1、属性data-url
                                （需要在右边选项卡中打开的页⾯的路径） -->
                                <!--2、属性data-title
                                （选项卡标题）-->
                                <!--3、属性data-id必须唯⼀，tab选项卡根据这个值进⾏切换-->
                                <!--4、id，也必须唯⼀，这⾥id设置为default-tab，设置该选项卡为默认显⽰的-->
                                <a href="#" data-url="chart1" data-title="图表一" data-id="11" id="default-tab" class="site-demo-active" data-type="tabAdd">
                                    图表一
                                </a>
                            </dd>
                            <dd>
                                <!--TODO -->
                                <!--需要修改为⾃⼰项⽬的部分：-->
                                <!--1、属性data-url
                                （需要在右边选项卡中打开的页⾯的路径） -->
                                <!--2、属性data-title
                                （选项卡标题）-->
                                <!--3、属性data-id必须唯⼀，tab选项卡根据这个值进⾏切换-->
                                <a href="#" data-url="chart2" data-title="图表二" data-id="22" class="site-demo-active"data-type="tabAdd">
                                    图表二
                                </a>
                            </dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="javascript:;">课程情况</a>
                        <dl class="layui-nav-child">
                            <dd>
                                <!--TODO -->
                                <!--需要修改为⾃⼰项⽬的部分：-->
                                <!--1、属性data-url
                                （需要在右边选项卡中打开的页⾯的路径） -->
                                <!--2、属性data-title
                                （选项卡标题）-->
                                <!--3、属性data-id必须唯⼀，tab选项卡根据这个值进⾏切换-->
                                <a href="#" data-url="chart3" data-title="图表三" data-id="44" class="site-demo-active"data-type="tabAdd">
                                    图表三
                                </a>
                            </dd>
                            <dd>
                                <!--TODO -->
                                <!--需要修改为⾃⼰项⽬的部分：-->
                                <!--1、属性data-url
                                （需要在右边选项卡中打开的页⾯的路径） -->
                                <!--2、属性data-title
                                （选项卡标题）-->
                                <!--3、属性data-id必须唯⼀，tab选项卡根据这个值进⾏切换-->
                                <a href="#" data-url="chart4" data-title="图表四" data-id="55" class="site-demo-active" data-type="tabAdd">
                                    图表四
                                </a>
                            </dd>
                        </dl>
                    </li>
                </ul>
            </div>
            <div class="layui-body">
                <!-- 内容主体区域 -->
                <div class="layui-tab" lay-filter="demo" lay-allowClose="true">
                    <!--tab页标题-->
                    <ul class="layui-tab-title">
                    </ul>
                    <!--tab页标题上右键，出现下⾯的 关闭当前和关闭所有的选项-->
                    <ul class="rightMenu" style="display: none;position: absolute;">
                        <li data-type="closeThis" class="layui-bg-cyan">关闭当前</li>
                        <li data-type="closeAll" class="layui-bg-cyan">关闭所有</li>
                    </ul>
                    <!--tab页主体内容区域-->
                    <div class="layui-tab-content">
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-footer">
            
        </div>
        <script src="./layui/layui.js"></script>
        <script>
            layui.use(['element','layer'], function () {
                var $ = layui.jquery;
                var element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
                //触发事件
                var active = {
                    // 在这⾥给active绑定⼏项事件，后⾯可通过active调⽤这些事件
                    tabAdd: function (url, id, name) {
                        // 新增⼀个Tab项 传⼊三个参数，分别对应其标题，tab页⾯的地址，还有⼀个规定的id，是标签中data-id的属性值
                        // 关于tabAdd的⽅法所传⼊的参数可看layui的开发⽂档中基础⽅法部分
                        element.tabAdd('demo', {
                            title: name,
                            // TODO
                            // 这⾥的选项卡页⾯路径： src="' + url + '.html" ，可能需要根据⾃⼰项⽬实际的后缀名修改
                            content: '<iframe data-frameid="' + id + '" scrolling="auto" frameborder="0" src="' + url + '.html" style="width:100%;height:99%;"></iframe>',
                            id: id // 规定好的id
                        })
                        CustomRightClick(id); // ⾃定义函数，给tab绑定右击事件
                        FrameWH(); // ⾃定义函数，计算iframe层的⼤⼩
                    },
                    tabChange: function (id) {
                        // 切换到指定Tab项
                        element.tabChange('demo', id); // 根据传⼊的id传⼊到指定的tab项
                    },
                    tabDelete: function (id) {
                        element.tabDelete("demo", id);// 删除
                    },
                    tabDeleteAll: function (ids) {// 删除所有
                        $.each(ids, function (i, item) {
                            element.tabDelete("demo", item); //ids是⼀个数组，⾥⾯存放了多个id，调⽤tabDelete⽅法分别删除
                        })
                    }
                };
                // 当点击有site-demo-active属性的标签时，即左侧菜单栏中内容 ，触发点击事件
                $('.site-demo-active').on('click', function () {
                    var dataid = $(this);
                    // 这时会判断右侧.layui-tab-title属性下的有lay-id属性的li的数⽬，即已经打开的tab项数⽬
                    if ($(".layui-tab-title li[lay-id]").length <= 0) {
                        // 如果⽐零⼩，则直接打开新的tab项
                     active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
                    } else {
                        // 否则判断该tab项是否已经存在
                        var isData = false; //初始化⼀个标志，为false说明未打开该tab项 为true则说明已有
                        $.each($(".layui-tab-title li[lay-id]"), function () {
                            //如果点击左侧菜单栏所传⼊的id 在右侧tab项中的lay-id属性可以找到，则说明该tab项已经打开
                            if ($(this).attr("lay-id") == dataid.attr("data-id")) {
                                isData = true;
                            }
                        })
                        if (isData == false) {
                            //标志为false 新增⼀个tab项
                            active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
                        }
                    }//最后不管是否新增tab，最后都转到要打开的选项页⾯上
                active.tabChange(dataid.attr("data-id"));active.tabChange(dataid.attr("data-id"));
                });
                function CustomRightClick(id) {
                    //取消右键 rightMenu属性开始是隐藏的 ，当右击的时候显⽰，左击的时候隐藏
                    $('.layui-tab-title li').on('contextmenu', function () {
                        return false;
                    })
                    $('.layui-tab-title,.layui-tab-title li').click(function () {
                        $('.rightMenu').hide();
                    });
                    //桌⾯点击右击
                    $('.layui-tab-title li').on('contextmenu', function (e) {
                        var popupmenu = $(".rightMenu");
                        popupmenu.find("li").attr("data-id", id); //在右键菜单中的标签绑定id属性
                        //判断右侧菜单的位置
                        l = ($(document).width() - e.clientX) < popupmenu.width() ? (e.clientX - popupmenu.width()) : e.clientX;
                        t = ($(document).height() - e.clientY) < popupmenu.height() ? (e.clientY - popupmenu.height()) : e.clientY;
                        popupmenu.css({left: l, top: t}).show(); //进⾏绝对定位
                        //alert("右键菜单")
                        return false;
                    });
                } 
                $(".rightMenu li").click(function () {
                    //右键菜单中的选项被点击之后，判断type的类型，决定关闭所有还是关闭当前。
                    if ($(this).attr("data-type") == "closeThis") {
                        //如果关闭当前，即根据显⽰右键菜单时所绑定的id，执⾏tabDelete
                        active.tabDelete($(this).attr("data-id"))
                    } else if ($(this).attr("data-type") == "closeAll") {
                        var tabtitle = $(".layui-tab-title li");
                        var ids = new Array();
                        $.each(tabtitle, function (i) {
                            ids[i] = $(this).attr("lay-id");
                        })
                        //如果关闭所有 ，即将所有的lay-id放进数组，执⾏tabDeleteAll
                        active.tabDeleteAll(ids);
                    } $('.rightMenu').hide(); //最后再隐藏右键菜单
                })
                // 计算frame⾼度
                function FrameWH() {
                    var h = $(window).height() - 41 - 10 - 60 - 10 - 44 - 10;
                    $("iframe").css("height", h + "px");
                } 
                $(window).resize(function () {
                    FrameWH();
                })
                var layer = layui.layer;
                layer.ready(function(){
                    // layer.msg('您已进⼊页⾯了！');
                    // 触发点击事件，这样就可以设置默认显⽰的选项卡页⾯
                    // TODO
                    // 可能需要修改的地⽅，标签id值
                    $("#default-tab").trigger( "click" );
                });
            });
        </script>
    
</body>